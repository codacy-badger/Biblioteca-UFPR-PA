<!DOCTYPE html>
<html lang='pt-br'>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Biblioteca UFPR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="../js/main.js"></script>
    <script src="../js/jquery-3.3.1.js"></script>
    <script src="https://use.fontawesome.com/releases/v5.0.8/js/all.js"></script>

    <link rel="stylesheet" href="../css/main.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

</head>
<body class="bodyPadrao">

    <div id="carregando" style="display: block; padding-top: 10%;">

        <center><i class="fas fa-spinner fa-spin fa-10x" style="color: #00487F;"></i></center>

    </div>

    <div id="passou" style="display: none">
    <div class="container containerSombra">
      <div class="row" style="background-image: url('../img/bg-azul.jpg');">
        <div class="col-sm">
          <div class="text-light container-principal-espacemento">
            <img src="../img/branco_UFPR.png"/>
          </div>
        </div>
      </div>

      <div class="row" style="background-color: #fff; padding-top: 2%; padding-bottom: 2%;">
          <div class="col-sm">

              <div class="card text-center">
                <div class="card-header">

                  <a id="turno"><i class="fas fa-cloud"></i> <i>Turno</i></a>

                </div>
                <div class="card-body">
                  <h5 class="card-title">Contador de usuários</h5>
                  <h1 class="card-text" id="contador">00</h1>
                  <button class="btn btn-success" onclick="adicionar()"><i class="fas fa-plus" style="color: #BBE2B8"></i></button>
                  <button class="btn btn-danger" onclick="remover()"><i class="fas fa-minus" style="color: #E8BEBE"></i></button>

                </div>
                <div class="card-footer text-muted">
                  <i id="ultAtualizacao">Última atualização</i>
                </div>
              </div>

          </div>

          <div class="col-sm-3">

              <div id="botoes" class="card">
                  <h5 class="card-header"><i class="fas fa-cog"></i> Opções</h5>
                  <div class="card-body">

                      <div class="btn-group-vertical btn-block">
                          <button id="registrarUsuarioBtn" type="button" class="btn btn-primary" data-toggle="modal" data-target="#registrarUsuario">
                              <i class="fas fa-user-plus"></i> Adicionar
                          </button>

                          <button  type="button" class="btn btn-primary" data-toggle="modal" data-target="#historicoUsuario">
                              <i class="fas fa-history"></i> Histórico
                          </button>

                          <button id="alterarDiaBtn" type="button" class="btn btn-primary" data-toggle="modal" data-target="#alterarDia">
                              <i class="fas fa-pencil-alt"></i> Alterar Dia
                          </button>

                          <a href="../restrito/area_restrita.php" class="btn btn-danger">
                              <i class="fas fa-sign-out-alt"></i> Sair
                          </a>


                      </div>

                      <!-- Histórico usuarios -->
                      <div class="modal fade" id="historicoUsuario" tabindex="-1" role="dialog" aria-labelledby="historicoUsuarioTittle" aria-hidden="true">
                          <div class="modal-dialog" role="document">
                              <div class="modal-content">
                                  <div class="modal-header">
                                      <h5 class="modal-title" id="historicoUsuarioTittle">Histórico Usuarios</h5>
                                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                          <span aria-hidden="true">&times;</span>
                                      </button>
                                  </div>
                                  <div class="modal-body">

                                      <form id="historicoUsuarioForm" class="form-inline">

                                          <div id="erroHistorico" class="alert alert-danger" role="alert">
                                              <b>Algo está errado</b>. Não foi possível encontrar históricos da data desejada!
                                          </div>

                                          <div class="form-group mb-2">

                                              <select id="mesHistorico" class="form-control">
                                                  <option selected>Mês</option>
                                                  <option value="1">Janeiro</option>
                                                  <option value="2">Fevereiro</option>
                                                  <option value="3">Março</option>
                                                  <option value="4">Abril</option>
                                                  <option value="5">Maio</option>
                                                  <option value="6">Junho</option>
                                                  <option value="7">Julho</option>
                                                  <option value="8">Agosto</option>
                                                  <option value="9">Setembro</option>
                                                  <option value="10">Outubro</option>
                                                  <option value="11">Novembro</option>
                                                  <option value="12">Dezembro</option>
                                              </select>

                                          </div>
                                          <div class="form-group mx-sm-3 mb-2">

                                              <label for="anoHistorico" class="sr-only">Ano</label>
                                              <input type="text" class="form-control" id="anoHistorico" value="2018">

                                          </div>
                                          <button type="submit" class="btn btn-outline-primary mb-2"><i class="fas fa-search"></i> Buscar</button>
                                      </form>

                                      <div id="aposProcurar"  style="display: none">
                                          <hr>

                                              <div id="historicoLista"></div>

                                              <!--<a id="historicoListaT"></a>-->


                                  </div>

                                  </div>

                              </div>
                          </div>
                      </div>
                      <!--- fim Histórico usuarios -->

                      <!-- Alterar Dia -->
                      <div class="modal fade" id="alterarDia" tabindex="-1" role="dialog" aria-labelledby="alterarDiaTittle" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                          <div class="modal-content">
                            <div class="modal-header">
                              <h3 class="modal-title" id="alterarDiaTitlle">Alterar histórico do dia</h3>
                              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                              </button>
                            </div>
                            <div class="modal-body">

                              <form id="alterarDiaForm">
                                  <div id="certoAlterarDia" class="alert alert-success" role="alert">
                                      <b>Modificações cadastradas!</b>
                                  </div>

                                  <div id="procurarDia" style="display: block">
                                    <div class="form-group">
                                      <label for="data">Insira uma data (YYYY-MM-DD): </label>
                                      <input type="text" class="form-control" id="data" placeholder="Ex: 2018-03-23">
                                    </div>


                                    <center>
                                      <button type="submit" class="btn btn-outline-primary"> <i class="fas fa-search"></i> Procurar</button>
                                    </center>
                                  </div>
                              </form>

                              <div id="aposProcurarData"  style="display: none">
                                  <form id='alterarDiaFormX'>

                                      <a id="diaHistorico">

                                  <center>
                                        <div class="custom-control custom-radio custom-control-inline">
                                          <input type="radio" id="customRadioInline1" name="customRadioInline1" class="custom-control-input" value="0">
                                          <label class="custom-control-label" for="customRadioInline1">Alterar dados</label>
                                        </div>
                                        <div class="custom-control custom-radio custom-control-inline">
                                          <input type="radio" id="customRadioInline2" name="customRadioInline1" class="custom-control-input" value="1">
                                          <label class="custom-control-label" for="customRadioInline2">Excluir</label>
                                        </div>
                                        <hr>
                                    <button type='submit' class='btn btn-success'> <i class='fas fa-check'></i> Confirmar</button>
                                    <button type='button' class='btn btn-danger' data-dismiss='modal'> <i class='fas fa-times'></i> Fechar</button>
                                  </center>
                                </form>
                              </div>

                            </div>
                            <!-- FOOTER AQUI -->
                          </div>
                        </div>
                      </div>
                      <!-- FIM Alterar dia -->

                  </div>
              </div>

          </div>

        </div>

        <div class="row text-light grid" style="background-image: url('../img/bg.jpg');">
          <div class="col-sm">

            <div class="container-fluid" style="text-align: center">
              <a href="https://www.facebook.com/krepper.fs" target="_blank"><img src="../img/minha_logo.png" alt="Felipe Sobral" style="padding-top: 0.5%; padding-bottom: 0.5%"/></a>  UFPR Biblioteca PA
            </div>
          </div>
        </div>
        </div>
        </div>


        <script>
          //$(document).ready(function(){
          function atualizaContador(){

              $.ajax({
                  url: "funcoes.php",
                  type: "post",
                  data: "funcao="+1+
                  "&numero="+0,
                  success: function(result){

                      if(result != null){
                          $("#contador").html("<h1 id='contador'>"+result.toString()+"</h1>");
                      }

                  }
              })

          }

          function atualizaUlt(){

              $.ajax({
                  url: "funcoes.php",
                  type: "post",
                  data: "funcao="+4+
                  "&numero="+0,
                  success: function(result){

                      if(result != null){
                          $("#ultAtualizacao").html(result);
                      }

                  }
              })

          }

          $(document).ready(function(){

                atualizaContador();
                atualizaUlt();

                $.ajax({
                    url: "funcoes.php",
                    type: "post",
                    data: "funcao="+3+"&numero="+0,
                    success: function(result){

                        if(result != null){
                            $("#turno").html(result);
                        }

                    }
                })

                $.ajax({
                    url: "funcoes.php",
                    type: "post",
                    data: "funcao="+5+"&numero="+0,
                    success: function(result){
                        if(result == 1){
                            document.getElementById("carregando").style.display = "none";
                            document.getElementById("passou").style.display = "block";
                        }else{
                            window.location='../index.html';
                        }
                    }
                })

                $('#erroHistorico').hide();
                $('#historicoUsuarioForm').submit(function(){
                    var anoHistorico=$('#anoHistorico').val();
                    var mesHistorico=$('#mesHistorico').val();



                    $.ajax({
                        url: "buscar_historico.php",
                        type: "post",
                        data: "anoHistorico="+anoHistorico+
                              "&mesHistorico="+mesHistorico,
                        success: function(result){
                            if(result == 0){
                                $('#erroHistorico').show();
                            } else {
                                $("#historicoLista").html(result);
                                document.getElementById("aposProcurar").style.display = "block";
                            }
                        }
                    })

                    return false;

              })

              $('#alterarDiaForm').submit(function(){
                  var data=$('#data').val();

                  $.ajax({
                      url: "alterarDia.php",
                      type: "post",
                      data: "data="+data+
                            "&verificar="+0,
                      success: function(result){
                         console.log(result);
                          if(result != 1){
                              document.getElementById("aposProcurarData").style.display = "none";

                          } else {

                              document.getElementById("aposProcurarData").style.display = "block";
                              jQuery("#diaHistorico").html(result);
                              /*
                              if(result==0){
                                  document.getElementById("certoAlterarLivro").style.display = "none";
                                  document.getElementById("errorProcurarLivro").style.display = "block";
                              }*/

                          }
                      }
                  })

                  return false;
              })


          })

          function adicionar(){

              $.ajax({
                  url: "funcoes.php",
                  type: "post",
                  data: "funcao="+0+
                  "&numero="+1,
                  success: function(result){

                      atualizaContador();
                      atualizaUlt();

                  }
              })

          }

          function remover(){
              $.ajax({
                  url: "funcoes.php",
                  type: "post",
                  data: "funcao="+2+"&numero="+1,
                  success: function(result){

                      atualizaContador();
                      atualizaUlt();

                  }
              })
          }

          function calcularTotalHistorico(anoHistorico, mesHistorico){

              $.ajax({
                  url: "buscar_historico.php",
                  type: "post",
                  data: "anoHistorico="+anoHistorico+
                        "&mesHistorico="+mesHistorico+
                        "&funcao="+1,
                  success: function(result){

                      $("#historicoListaT").html(result);

                  }
              })

              return false;
          }


        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  </body>
</html>
