<!DOCTYPE html>
<html lang='pt-br'>

<!--
    - Felipe Vieira Sobral
    - xfelipesobral@gmail.com
    - felipesobral@ufpr.br
    - https://felipesobral.xyz
    - https://github.com/krepper/Biblioteca-UFPR-PA/
-->

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Biblioteca UFPR</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    .carregando {
      padding-top: 35vh;
      padding-left: 300px;
      padding-right: 300px;
    }

    .cab {
      -webkit-box-shadow: 0px 4px 19px -6px rgba(0, 0, 0, 0.75);
      -moz-box-shadow: 0px 4px 19px -6px rgba(0, 0, 0, 0.75);
      box-shadow: 0px 4px 19px -6px rgba(0, 0, 0, 0.75);
    }

    @media only screen and (max-width: 992px) {
      .carregando {
        padding-right: 0;
        padding-left: 0;
      }
    }
  </style>

  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/css/materialize.min.css">
</head>

<body style="background-color: black; background-image: url('img/bg.jpg'); background-attachment: fixed;" onload="document.getElementById('usuario').focus();">

  <div id="carregando" class="carregando text-light" style="display: block;">
    <center>
      <div class="progress">
        <div class="indeterminate"></div>
      </div>
      <h1 class="display-4">Verificando...</h1>
    </center>
  </div>

  <div id="passou" style="display: none">
    <div class="container">
      <center><img src="img/branco_UFPR.png" width="250px" /></center>
      <div class="card" style="opacity: 0.9">
        <div class="card-content">
          <h5 style="text-align: center">Fazer login</h5>
          <div class="row">
            <form class="col s12" id="loginform">
              <div class="row">
                <div class="input-field col s6">
                  <input type="text" id="usuario"></input>
                  <label for="usuario">Usu√°rio</label>
                </div>
                <div class="input-field col s6">
                  <input type="password" id="senha"></input>
                  <label for="senha">Senha</label>
                </div>
              </div>
              <center><button class="btn waves-effect waves-light" type="submit">Entrar</button></center>
            </form>
          </div>
          <center><a href="https://goo.gl/forms/QvhPwxZpUs0IT1Ys1" target="_blank">Algum problema?</a></center>
        </div>
      </div>
    </div>
  </div>

  <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  <script>
    function liberar(){
      $.ajax({
        url: "verificar.php",
        type: "post",
        data: "executarFuncao=" + 5,
        success: function(result) {
          if (result == 0) {
            document.getElementById("carregando").style.display = "none";
            document.getElementById("passou").style.display = "block";
          } else {
            window.location = 'home_restrita.html';
          }
        }
      })
    }

    $(document).ready(function() {
      $.ajax({
        url: "seguranca.php",
        type: "post",
        data: "ajaxS="+1,
        success: function(x){
          if(x==false){
            location.href = 'error.html';
          } else {
            liberar();
          }
        }
      })


      $('#loginform').submit(function() {
        var usuario = $('#usuario').val();
        var senha = $('#senha').val();
        $.ajax({
          url: "login.php",
          type: "post",
          data: "usuario=" + usuario +
            "&senha=" + senha +
            "&funcao=" + 0,
          success: function(result) {
            if (result == 1) {
              location.href = 'home_restrita.html';
            }
            if (result == 0) {
              M.toast({
                html: "<i class='material-icons' style='color: #ff5151'>clear</i>"
              });
            }
          }
        })

        return false;
      })

    })
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/js/materialize.min.js"></script>

</body>

</html>
